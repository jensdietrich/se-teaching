# Generating a Parser with Antlr

Using parser generators is a viable alternative to writing parsers by hand (a complex and error-prone task). Parser generators use a formal definition of a grammar, 
and generate code to parse and represent input complying to this grammar, for instance, by producing a parse tree that can be traversed and queried. 

A modern, widely used parser generator is [antlr](https://www.antlr.org/). Antlr can emit source code in various languages, including Java. In this example here, we use a grammar of JSON to generate a parser, 
the grammar can be found in [JSON.g4](src/main/antlr4/nz/ac/vuw/jenz/jsonparser/parser/JSON.g4). Note that the grammar is only a simplified version of JSON, it does not support special values like `true` and `false`, escaped characters and only allows a restricted set of characters to be used in keys and values.
Those simplifications have been made for readability.

Antlr is fully integrated into the Maven build through the use of the respective plugin, check `pom.xml` for details. When the project is build, antlr generates the parser source code in `target/generated-sources`. 
These sources are part of the classpath, and can be referenced by application classes within `src/main/java` . 

## JSON Parsing

The grammar is in `src/main/antlr4/nz/ac/vuw/jenz/jsonparser/parser/JSON.g4`.

### Application: Transforming JSON to XML

The sample application is a single class `nz.ac.vuw.jenz.jsonparser.JSON2XML` that parses a JSON document with nested arrays and objects, and transforms it into an XML document. This is done by implementing 
a `JSONListener` (this is an interface generated by the parser), the methods are callbacks invoked when the parse tree generated by the parser is traversed.

### Visualising the Parse Tree (via `dot`)
The class `nz.ac.vuw.jenz.jsonparser.VisualiseParseTree` illustrates how to visualise the parse tree. It generates a dot file that can be easily transformed into other formats (png, svg) by graphviz or
similar programs. 

### Querying the Parse Tree with XPath

The class `nz.ac.vuw.jenz.jsonparser.QueryParseTreeWithXPath` demonstrates how to query the parse tree with XPath. 

## Arithmetic Expression Parsing

The grammar is in `src/main/antlr4/nz/ac/vuw/jenz/expressions/parser/ArithmeticExpression.g4`

There is also a script to visualise the parse tree (`src/main/antlr4/nz/ac/vuw/jenz/expressions/parser/ArithmeticExpression.g4`) and some tests illustrating the functionality.

Note that the order of productions is used to define operator precedence. 


